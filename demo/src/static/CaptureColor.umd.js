!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("html2canvas"),require("clipboard")):"function"==typeof define&&define.amd?define(["html2canvas","clipboard"],e):t.CaptureColor=e(t.html2canvas,t.Clipboard)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;const i=require("uuid/v4");function n(t){this.Id=t.el,this.scale=t.scale||1,this.node={},this.color=""}return n.prototype.setCanvas_s=function(t=100,e=100){let i=document.createElement("canvas");return i.id=this.uuid+"-s",i.setAttribute("width",t),i.setAttribute("height",e),i.getContext("2d"),i},n.prototype.setImg=function(t){let e=this.node.width,i=this.node.height,n=new Image(e,i);n.style.cssText="position: absolute;top:0;left:0;right:0;bottom:0;z-index:99999999 !important;",n.crossOrigin="Anonymous",n.onload=(()=>{console.log("Image is loaded")}),n.src=t||"",document.body.appendChild(n)},n.prototype.transformToImg=function(e){let i=e.getBoundingClientRect();t(e,{useCORS:!0}).then(t=>{let e=t;e.id=this.uuid,e.style.cssText=`position: absolute;top:${i.top}px;left:${i.left}px;width:${i.width}px;height:${i.height}px;z-index:11111111 !important;`,document.body.appendChild(e);e.getContext("2d");let n=document.getElementById(this.uuid+"-s").getContext("2d"),o=document.getElementById(this.uuid+"-info"),s=document.getElementById(this.uuid+"-div");e.onmousemove=(t=>{n.drawImage(e,t.x-i.left-50/this.scale,t.y-i.top-50/this.scale,100,100,0,0,100*this.scale,100*this.scale);let d=this.RgbToHex(n.getImageData(50,50,1,1).data.slice(0,3).toString());o.getElementsByTagName("p")[0].innerText=`(${t.x}, ${t.y})`,o.getElementsByTagName("p")[1].getElementsByTagName("i")[0].style.backgroundColor=d,o.getElementsByTagName("p")[1].getElementsByTagName("span")[0].innerText=`${d}`,s.style.top=(t.y<i.top+i.height-150?t.y+15:t.y-150-15)+"px",s.style.left=(t.x<i.left+i.width-150?t.x+15:t.x-100-15)+"px",this.color=d}),e.onclick=(()=>{document.getElementById(this.uuid+"-info-btn").click(),this.reset()})}).catch(t=>{console.error(t)})},n.prototype.RgbToHex=function(t){return"#"+t.replace(/[^\d,]/g,"").replace(/(\d+)/g,function(t,e){let i=parseInt(e).toString(16);return 1==i.length?"0"+i:i}).replace(/,/g,"").toUpperCase()},n.prototype.infoShow=function(t){let e=document.createElement("div");e.id=this.uuid+"-info",e.style.cssText="font-size:12px;color:#fff;text-align:center;background: rgba(0, 0, 0, 0.8)";let i=`<p style="margin:0;">(x, y)</p>\n    <p style="margin:0;"><i style="display: inline-block;width:10px;height:10px;"></i> <span id="${this.uuid+"color"}"></span></p>\n    <p style="margin:0;">按 c 复制颜色值</p>\n    <a id="${e.id+"-btn"}" class="${e.id+"-btn"}" href="javascript:" style="display:block;height:0;overflow: hidden;" data-clipboard-target="#${this.uuid+"color"}">复制</a>\n    <span>\n        <i style="position:absolute;top:50px;left:45px;width:11px;height:0.5px;background:red;display:inline-block;box-shadow: 0 0 1px #fff;"></i>\n        <i style="position:absolute;top:45px;left:50px;width:0.5px;height:11px;background:red;display:inline-block;box-shadow: 0 0 1px #fff;"></i>\n    </span>`;return e.innerHTML=i,e},n.prototype.keyListener=function(t){67===t.keyCode&&(document.getElementById(this.uuid+"-info-btn").click(),document.getElementById(this.uuid+"-div").style["box-shadow"]="0px 0px 10px yellow",setTimeout(()=>{document.getElementById(this.uuid+"-div").style["box-shadow"]="0px 0px 5px #fff"},500))},n.prototype.Exit=function(t){27===t.keyCode&&this.uuid&&this.reset()},n.prototype.reset=function(){document.removeEventListener("keydown",this.keyListener,!1),document.removeEventListener("keydown",this.Exit,!1);let t=document.getElementById(this.uuid),e=document.getElementById(this.uuid+"-div"),i=t.parentElement,n=e.parentElement;i.removeChild(t),n.removeChild(e),this.uuid="",this.clipboard.destroy(),this.clipboard=null},n.prototype.pickColor=function(){this.uuid=this.uuid?this.uuid:"cc"+i().split("-")[0],this.node=document.getElementById(this.Id),this.node.style.position="relative",this.transformToImg(this.node);let t=this.setCanvas_s(),n=document.createElement("div");return n.id=this.uuid+"-div",n.style.cssText="display:inline-block;position:absolute;font-size: 0;box-shadow: 0 0 5px #fff;z-index:99999999 !important",n.appendChild(t),n.appendChild(this.infoShow()),document.body.appendChild(n),this.keyListener=this.keyListener.bind(this),this.Exit=this.Exit.bind(this),document.addEventListener("keydown",this.keyListener),document.addEventListener("keydown",this.Exit),this.clipboard=new e(document.getElementById(this.uuid+"-info-btn")),new Promise((t,e)=>{this.clipboard.on("success",function(e){console.log("成功复制至剪切板",e.text),e.clearSelection(),t(e.text)}),this.clipboard.on("error",function(t){e(t)})})},n});
